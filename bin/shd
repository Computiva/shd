#! /bin/bash

coproc bashproc { bash; }

example() {
	example=`echo $1 | cut -c 3-`
	echo $example >&${bashproc[1]}
}

expected() {
	expected=`echo $1 | cut -c 3-`
	read -u ${bashproc[0]} got
	[ "$expected" = "$got" ] && echo . || failed "$example" "$expected" "$got"
}

failed() {
	echo F
	echo "Failed example:" >&2
	echo "    $1" >&2
	echo "Expected:" >&2
	echo "    $2" >&2
	echo "Got:" >&2
	echo "    $3" >&2
}

while read line
do
	[[ "$line" =~ ^\$\ .* ]] && example "$line"
	[[ "$line" =~ ^\<\ .* ]] && expected "$line"
done

exit 0
